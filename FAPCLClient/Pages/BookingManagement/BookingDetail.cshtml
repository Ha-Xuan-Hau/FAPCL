@page
@model BookingDetailModel
@{
    ViewData["Title"] = "Booking Detail";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}
<h2 class="text-center text-primary mb-4">@ViewData["Title"]</h2>

<div class="container">
    <form method="get" style="display: flex; justify-content: flex-end; align-items: center;">
        <div style="margin-bottom: 15px; display: flex; align-items: center;">
            <input type="text" name="searchQuery" placeholder="Enter room name" value="@Model.SearchQuery" style="padding: 10px; border: 1px solid #ccc; border-radius: 4px; margin-right: 10px;" />
            <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i> </button>
        </div>
    </form>

    @if (Model.IsAdmin)
    {
        
        <div class="table-responsive mt-4">
            <table class="table table-bordered table-striped shadow-sm">
                <thead class="table-primary text-center">
                    <tr>
                        <th>Booking ID</th>
                        @if (User.IsInRole("Admin"))
                        {
                            <th>UserBooking</th>
                        }
                        <th>Room</th>
                        <th>Slot</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var booking in Model.AllBookings)
                    {
                        <tr>
                            <td>@booking.BookingId</td>
                            @if (User.IsInRole("Admin"))
                            {
                                <td>@booking.User.Email</td>
                            }
                            <td>@booking.Room.RoomName</td>
                            <td>@booking.Slot.SlotName</td>
                            <td>@booking.SlotBookingDate.ToString("yyyy-MM-dd")</td>
                            <td>
                                <span class="status
                                        @(booking.Status == "Confirmed" ? "text-success" :
                                        booking.Status == "Cancelled" ? "text-danger" :
                                        booking.Status == "Completed" ? "text-warning" : "")">
                                        @booking.Status
                                </span>
                                </td>
                                <td>
                                @if (booking.Status == "Confirmed")
                                {
                                    <form method="post" asp-page-handler="CancelBooking" class="d-inline">
                                        <input type="hidden" name="BookingId" value="@booking.BookingId" />
                                        <button type="submit" class="btn btn-danger btn-sm ms-2">Cancel Booking</button>
                                    </form>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <div class="mt-4">
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    <li class="page-item @(Model.CurrentPage <= 1 ? "disabled" : "")">
                        <a class="page-link" asp-route-currentPage="@(Model.CurrentPage - 1)">Previous</a>
                    </li>
                    @for (int i = 1; i <= Model.TotalPages; i++)
                    {
                        <li class="page-item @(Model.CurrentPage == i ? "active" : "")">
                            <a class="page-link" asp-route-currentPage="@i">@i</a>
                        </li>
                    }
                    <li class="page-item @(Model.CurrentPage >= Model.TotalPages ? "disabled" : "")">
                        <a class="page-link" asp-route-currentPage="@(Model.CurrentPage + 1)">Next</a>
                    </li>
                </ul>
            </nav>
        </div>
    }
    else
    {
       <!-- <h3>Confirmed Bookings</h3>-->
        <div class="table-responsive mt-4">
            <table class="table table-bordered table-striped shadow-sm">
                <thead class="table-primary text-center">
                    <tr>
                        <th>Booking ID</th>
                        <th>Room</th>
                        <th>Slot</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var booking in Model.ConfirmedBookings)
                    {
                        <tr>
                            <td>@booking.BookingId</td>
                            <td>@booking.Room.RoomName</td>
                            <td>@booking.Slot.SlotName</td>
                            <td>@booking.SlotBookingDate.ToString("yyyy-MM-dd")</td>
                            <td>
                                <span class="status
                                        @(booking.Status == "Confirmed" ? "text-success" :
                                        booking.Status == "Cancelled" ? "text-danger" :
                                        booking.Status == "Completed" ? "text-warning" : "")">
                                    @booking.Status
                                </span>
                                </td>
                                <td>
                                @if (booking.Status == "Confirmed")
                                {
                                    <form method="post" asp-page-handler="CancelBooking" class="d-inline">
                                        <input type="hidden" name="BookingId" value="@booking.BookingId" />
                                        <button type="submit" class="btn btn-danger btn-sm ms-2">Cancel Booking</button>
                                    </form>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

       <!-- <h3>Completed And Cancel Bookings</h3>-->
        <div class="table-responsive mt-4">
            <table class="table table-bordered table-striped shadow-sm">
                <thead class="table-primary text-center">
                    <tr>
                        <th>Booking ID</th>
                        <th>Room</th>
                        <th>Slot</th>
                        <th>Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var booking in Model.CompleteBookings)
                    {
                        <tr>
                            <td>@booking.BookingId</td>
                            <td>@booking.Room.RoomName</td>
                            <td>@booking.Slot.SlotName</td>
                            <td>@booking.SlotBookingDate.ToString("yyyy-MM-dd")</td>
                            <td>
                            <span class="status
                                        @(booking.Status == "Confirmed" ? "text-success" :
                                        booking.Status == "Cancelled" ? "text-danger" :
                                        booking.Status == "Completed" ? "text-warning" : "")">
                                @booking.Status
                            </span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <div class="mt-4">
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    <li class="page-item @(Model.CurrentPage <= 1 ? "disabled" : "")">
                        <a class="page-link" asp-route-currentPage="@(Model.CurrentPage - 1)">Previous</a>
                    </li>
                    @for (int i = 1; i <= Model.TotalPages; i++)
                    {
                        <li class="page-item @(Model.CurrentPage == i ? "active" : "")">
                            <a class="page-link" asp-route-currentPage="@i">@i</a>
                        </li>
                    }
                    <li class="page-item @(Model.CurrentPage >= Model.TotalPages ? "disabled" : "")">
                        <a class="page-link" asp-route-currentPage="@(Model.CurrentPage + 1)">Next</a>
                    </li>
                </ul>
            </nav>
        </div>
    }
</div>